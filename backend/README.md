# Catan Island - åç«¯æœåŠ¡å™¨

åŸºäº Node.js + WebSocket çš„å¡å¦å²›æ¸¸æˆæœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… WebSocket å®æ—¶é€šä¿¡
- âœ… å¤šæˆ¿é—´æ”¯æŒ
- âœ… æ¸¸æˆçŠ¶æ€ç®¡ç†
- âœ… è‡ªåŠ¨æ–­çº¿é‡è¿
- âœ… å®Œæ•´çš„æ¸¸æˆé€»è¾‘éªŒè¯

## æŠ€æœ¯æ ˆ

- **Node.js** - è¿è¡Œç¯å¢ƒ
- **TypeScript** - ç±»å‹å®‰å…¨
- **ws** - WebSocket åº“
- **uuid** - å”¯ä¸€IDç”Ÿæˆ

## å®‰è£…ä¾èµ–

```bash
npm install
```

## å¯åŠ¨æœåŠ¡å™¨

### å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
```bash
npm run dev
```

### ç”Ÿäº§æ¨¡å¼
```bash
npm run build
npm start
```

## æœåŠ¡å™¨é…ç½®

- **ç«¯å£**: 8080
- **åè®®**: WebSocket (ws://)
- **æœ€å¤§ç©å®¶æ•°**: 4äºº/æˆ¿é—´

## WebSocket æ¶ˆæ¯åè®®

### å®¢æˆ·ç«¯ -> æœåŠ¡å™¨

| æ¶ˆæ¯ç±»å‹ | è¯´æ˜ | Payload |
|---------|------|---------|
| `JOIN_GAME` | åŠ å…¥æ¸¸æˆ | `{ gameId?, playerId?, playerName }` |
| `ROLL_DICE` | æ·éª°å­ | - |
| `BUILD_ROAD` | å»ºé€ é“è·¯ | `{ edgeId }` |
| `BUILD_SETTLEMENT` | å»ºé€ å®šå±…ç‚¹ | `{ vertexId }` |
| `UPGRADE_CITY` | å‡çº§åŸå¸‚ | `{ vertexId }` |
| `END_TURN` | ç»“æŸå›åˆ | - |

### æœåŠ¡å™¨ -> å®¢æˆ·ç«¯

| æ¶ˆæ¯ç±»å‹ | è¯´æ˜ | Payload |
|---------|------|---------|
| `PLAYER_ID` | ç©å®¶ID | `{ playerId, gameId }` |
| `GAME_STATE` | æ¸¸æˆçŠ¶æ€ | `GameState` |
| `NOTIFICATION` | é€šçŸ¥æ¶ˆæ¯ | `{ message, type }` |
| `ERROR` | é”™è¯¯æ¶ˆæ¯ | `{ message }` |

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”œâ”€â”€ GameManager.ts    # æ¸¸æˆæˆ¿é—´ç®¡ç†
â”‚   â”‚   â””â”€â”€ GameLogic.ts      # æ¸¸æˆé€»è¾‘å¤„ç†
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ mapGenerator.ts   # åœ°å›¾ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ types.ts              # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ server.ts             # WebSocket æœåŠ¡å™¨
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„æ¸¸æˆæ“ä½œ

1. åœ¨ `types.ts` ä¸­æ·»åŠ æ¶ˆæ¯ç±»å‹
2. åœ¨ `GameLogic.ts` ä¸­å®ç°é€»è¾‘
3. åœ¨ `server.ts` ä¸­æ·»åŠ æ¶ˆæ¯å¤„ç†

### è°ƒè¯•

æœåŠ¡å™¨ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
- ğŸ“¡ å®¢æˆ·ç«¯è¿æ¥
- âœ… æ“ä½œæˆåŠŸ
- âŒ æ“ä½œå¤±è´¥
- ğŸ® æ¸¸æˆäº‹ä»¶

## éƒ¨ç½²

### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# æ„å»ºé•œåƒ
docker build -t catan-server .

# è¿è¡Œå®¹å™¨
docker run -p 8080:8080 catan-server
```

### äº‘æœåŠ¡å™¨éƒ¨ç½²

1. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
2. å®‰è£…ä¾èµ–: `npm install`
3. æ„å»º: `npm run build`
4. ä½¿ç”¨ PM2 è¿è¡Œ: `pm2 start dist/server.js --name catan-server`

## æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†é«˜å¹¶å‘
- å®ç°æ¸¸æˆçŠ¶æ€ç¼“å­˜
- æ·»åŠ æ•°æ®åº“æŒä¹…åŒ–
- ä½¿ç”¨ Redis å­˜å‚¨ä¼šè¯

## å®‰å…¨å»ºè®®

- æ·»åŠ ç©å®¶èº«ä»½éªŒè¯
- å®ç°æ“ä½œé¢‘ç‡é™åˆ¶
- éªŒè¯æ‰€æœ‰å®¢æˆ·ç«¯è¾“å…¥
- ä½¿ç”¨ WSS (WebSocket Secure)

## License

MIT

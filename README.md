# Catan Island - 卡坦岛在线多人网页游戏

[![GitHub](https://img.shields.io/badge/GitHub-CatanIsland-blue)](https://github.com/Frank-Unlimited/CatanIsland-)
[![Docker](https://img.shields.io/badge/Docker-Ready-green)](https://hub.docker.com)
[![License](https://img.shields.io/badge/License-MIT-yellow)](LICENSE)

一款基于 WebSocket 的实时多人在线卡坦岛桌游，支持 2-4 人同时游戏。

## 🎮 游戏特色

- ✅ **实时多人对战**：基于 WebSocket 的实时同步
- ✅ **完整游戏逻辑**：包含资源收集、交易、建造、发展卡等完整机制
- ✅ **地图构建系统**：支持自定义种子生成随机地图
- ✅ **港口交易系统**：9个港口均匀分布，支持优惠交易
- ✅ **强盗机制**：完整的强盗移动和资源掠夺系统
- ✅ **发展卡系统**：骑士卡、胜利点卡、特殊能力卡
- ✅ **精美UI**：现代化的卡牌UI和动画效果

## 🚀 快速开始

### 🎯 5分钟快速部署

查看 [快速开始指南](QUICKSTART.md) 了解如何在 5 分钟内完成首次部署。

### 使用 Docker（推荐）

```bash
# 拉取镜像
docker pull crpi-925djdtsud86yqkr.cn-hangzhou.personal.cr.aliyuncs.com/hhc510105200301150090/catan_island:latest

# 运行容器
docker run -d -p 3000:3000 --name catan-island \
  crpi-925djdtsud86yqkr.cn-hangzhou.personal.cr.aliyuncs.com/hhc510105200301150090/catan_island:latest

# 访问游戏
# 打开浏览器访问 http://localhost:3000
```

### 本地开发

#### 前端

```bash
cd fronted
npm install
npm run dev
```

#### 后端

```bash
cd backend
npm install
npm run dev
```

## 📦 部署

### GitHub Actions 自动部署（推荐）

1. **配置 Secrets**：查看 [GitHub Actions 设置指南](.github/SETUP.md)
2. **推送代码**：`git push origin main`
3. **自动部署**：GitHub Actions 会自动构建并推送到阿里云
4. **查看进度**：访问 [Actions 页面](https://github.com/Frank-Unlimited/CatanIsland-/actions)

详细部署文档请查看：
- 📖 [快速开始指南](QUICKSTART.md) - 5分钟快速部署
- 📖 [完整部署文档](README_DEPLOY.md) - 详细的部署选项
- 🔧 [GitHub Actions 设置](.github/SETUP.md) - CI/CD 配置

### 本地部署

### 自动化部署

**Linux/Mac:**
```bash
chmod +x deploy.sh
./deploy.sh v1.0.0
```

**Windows:**
```bash
deploy.bat v1.0.0
```

## 🎯 游戏规则

### 游戏介绍
卡坦岛是一款适合 2-4 人游玩的资源经营类桌游，核心目标是通过收集资源、交易谈判、建设领地来率先获得 10 个胜利点。游戏开始时，玩家需先共同拼接由 19 块六边形地形板块（草原、森林、山地、丘陵、田野、荒漠，分别对应羊毛、木材、砖块、矿石、粮食、无资源）组成的随机岛屿版图，每块地形上都标有 2-12 的骰子点数，随后玩家轮流在版图边缘的交点放置2 个定居点和连接定居点的2 条道路，规则要求定居点之间必须间隔至少 1 个路段，避免初始位置过近。
游戏的核心回合流程为：玩家掷出 2 颗骰子，点数对应的所有地形板块旁的定居点 / 城市拥有者，会获得该地形的对应资源卡；若掷出 7 点，则触发强盗机制—— 所有手中资源卡超过 7 张的玩家需弃掉一半手牌，掷点玩家可将强盗棋子移动到任意一块地形上，该地形将停止产出资源，同时玩家可以掠夺版图内任意一名与强盗相邻的玩家的 1 张随机资源卡。
玩家收集到资源后，可消耗对应组合的资源进行建设：用木材 + 砖块能造道路（拓展领地范围，助力后续放置定居点，无胜利点）；用木材 + 砖块 + 羊毛 + 粮食能造新定居点（需放在已有的道路端点，且满足间隔规则，获得 1 个胜利点，每回合可根据相邻地形点数获取资源）；用 3 个矿石 + 2 个粮食可将定居点升级为城市（获得 2 个胜利点，资源产出量翻倍）；用 1 个羊毛 + 1 个矿石 + 1 个粮食能购买发展卡，发展卡分为三类 —— 骑士卡（打出后可移动强盗，累计打出 3 张可获得 1 个骑士团胜利点）、胜利点卡（直接获得 1 个胜利点）、特殊能力卡（如垄断卡，可指定一种资源，让所有玩家交出该资源卡归自己；道路建设卡，可免费建造 2 条道路等）。
游戏全程支持玩家自由交易资源，既可以和其他玩家一对一谈判交换，也可以用 4 张相同资源卡向银行兑换 1 张任意资源卡，交易是补足短板资源的关键手段。率先通过 “定居点 + 城市 + 发展卡 + 骑士团” 等方式累计获得10 个胜利点的玩家，立即赢得游戏胜利。

# 游戏地图
地图整体样子：卡坦岛地图由 19 个内陆六角形板块和 6 个海洋板块随机拼接而成，整体呈不规则形状。海洋板块围绕在六角形内陆板块周围，形成岛屿的轮廓。此外，还有 9 张码头纸片分布在海洋板块与内陆板块的边缘，代表港口。
地图板块元素及作用
地形板块：包含 6 种不同地形，分别是森林、矿山、田地、草原、山丘和沙漠。森林产出木材，矿山产出矿石，田地产出粮食，草原产出羊毛，山丘产出砖块，沙漠不产出资源。这些地形板块是玩家获取资源的主要来源，玩家通过掷骰子，根据点数获得对应地形板块的资源。
数字圆片：有 18 个圆形纸片，上面标有 2-12 的数字（不包含 7），随机放置在除沙漠外的地形板块上。这些数字决定了资源产出的时机，当玩家掷出的骰子点数与地形板块上的数字相同时，该地形板块旁的定居点或城市拥有者就能获得相应资源。
交叉点：指六角形区域的端点，也是两个或三个区域的交界处。玩家的定居点和城市只能建造在交叉点上，每个交叉点上只能有一栋建筑，定居点和城市通过与相邻的地形板块连接来获取资源。
边：六角形区域版图的每一边都是 “边”，包括两个内陆区域共用的边以及内陆区域与海洋版图共用的边。道路只能建造在边上，且每边只能有一条道路，边的两端是交叉点，用于连接不同的定居点和城市，拓展玩家的领地范围。
港口：由码头纸片表示，分布在海岸线的交叉点上。港口的作用是让玩家以较好的兑换率和银行交易资源，不同类型的港口兑换比例不同，如 3:1 港口可以用 3 点同样种类的资源换取 1 点任意其他种类的资源，特殊资源港口则可以用 2 点特定资源换取 1 点任意其他种类的资源。
强盗：是一个棋子，游戏开始时放置在沙漠上。当玩家掷出 7 点或有玩家使用骑士卡时，强盗会移动到其他地形板块上，被强盗占据的地形板块停止产出资源，且与该地形板块相邻的定居点或城市无法从该板块获得资源，同时掷出 7 点或使用骑士卡的玩家可以掠夺该地形板块顶点上任意一名玩家的 1 张资源卡。

# 游戏卡牌
卡坦岛桌游的卡牌核心分为**资源卡、发展卡、特殊成就卡、辅助卡**四类，以下是基础版的详细信息（含数量与作用）：
### 资源卡（共95张）
|资源类型|数量|作用|
| ---- | ---- | ---- |
|木材|19|用于建造道路、定居点|
|羊毛|19|用于建造定居点、购买发展卡|
|砖块|19|用于建造道路、定居点|
|矿石|19|用于升级城市、购买发展卡|
|粮食|19|用于建造定居点、升级城市、购买发展卡|

资源卡是游戏的基础物资，玩家通过掷骰子点数获取，用于建设领地和购买发展卡，也可与其他玩家或银行交易。

---

### 发展卡（共25张）
|卡牌类型|数量|作用|
| ---- | ---- | ---- |
|骑士卡|14|打出可移动强盗，掠夺相邻玩家1张资源卡；累计打出3张可获“最大军队”特殊成就卡（2胜利点，可被超越）|
|胜利点卡|5|直接获得1胜利点，无需打出，获胜时展示即可|
|道路建设卡|2|打出后免费建造2条道路，拓展领地，助力放置新定居点|
|丰饶之年卡|2|打出后从银行自选2张资源卡|
|垄断卡|2|打出后指定一种资源，所有其他玩家需交出该类资源卡给你|

发展卡需消耗1羊毛+1矿石+1粮食购买，每回合仅能打出1张，且不能打出本回合刚买的卡。

---

### 特殊成就卡（共2张）
|卡牌类型|数量|作用|
| ---- | ---- | ---- |
|最长道路卡|1|奖励给拥有最长连续道路（至少5条）的玩家，获得2胜利点，可被超越|
|最大军队卡|1|奖励给累计打出3张及以上骑士卡的玩家，获得2胜利点，可被超越|

这两张卡为竞争型成就卡，玩家满足条件时自动获得，失去条件时则会被其他玩家夺走。

---

### 辅助卡（共4张）
|卡牌类型|数量|作用|
| ---- | ---- | ---- |
|建筑成本卡|4|标注建造道路、定居点、城市和购买发展卡所需的资源组合，供玩家随时查阅|

# 村庄、道路、城市修建规则
一、道路
资源消耗：1 木材 + 1 砖块。
修建规则
只能建在版图的边（地形板块交界处），每条边仅能有 1 条道路。
新道路必须连接到自己已有的道路、定居点或城市，不能凭空建造。
连续道路长度达 5 条及以上，可获得 “最长道路卡”（2 胜利点，可被更长道路的玩家夺走）。
核心作用：拓展领地，为新定居点提供可放置的端点，助力争夺最长道路成就。
二、定居点（村庄）
资源消耗：1 木材 + 1 砖块 + 1 羊毛 + 1 粮食。
修建规则
只能建在版图的交点（3 块地形板块交汇处），且该交点必须空置。
严格遵循 “距离规则”：新定居点与其他玩家的定居点 / 城市之间，必须间隔至少 1 个交点（即至少隔 1 个路段），避免相邻建造。
必须建在自己的道路端点上，确保与自身领地相连。
每个玩家最多可建造 5 个定居点。
核心作用：每拥有 1 个定居点得 1 胜利点，相邻地形掷出对应骰子点数时，可获得 1 张对应资源卡，是获取资源和积累胜利点的基础。
三、城市
资源消耗：3 矿石 + 2 粮食。
修建规则
不能直接建造，只能通过升级已有的定居点获得，升级时移除原定居点，在同一交点放置城市。
每个玩家最多可建造 4 个城市。
核心作用：每拥有 1 个城市得 2 胜利点，相邻地形产资源时，城市获得的资源数量翻倍（1 个城市等效 2 个定居点的产出），大幅提升资源获取效率。

# 港口
一、港口的位置
港口都在地图最外围的海洋板块边缘，固定有 9 个，每个港口对应2个版图边缘的交点，该交点是定居点 / 城市的合法放置点。
港口类型分布：4 个 3:1 通用港口，5 个 2:1 特殊资源港口（木材、羊毛、砖块、矿石、粮食各 1 个）。
二、港口的类型与作用
港口的核心作用是降低与银行航海交易的资源消耗，仅当玩家在港口对应的交点建有定居点 / 城市时，才能享受该港口的交易优惠。
港口类型	数量	交易优惠	核心作用
3:1 通用港口	4	3 张同类型资源卡换 1 张任意资源卡	适配资源种类较多的开局，灵活补充稀缺资源，降低交易成本
2:1 特殊资源港口	5（每种资源 1 个）	2 张指定类型资源卡换 1 张任意资源卡	适合该资源产出稳定的玩家，大幅提升该资源的交易效率，快速补齐发展缺口
三、交易规则（含港口与无港口）
交易分玩家间贸易（国内贸易）和与银行贸易（航海贸易），仅当前回合玩家可发起或参与交易。
无港口时：航海贸易默认 4:1，即 4 张同类型资源卡换 1 张任意资源卡。
有港口时：仅触发对应港口的优惠汇率，不可叠加；例如在木材 2:1 港口建了定居点，仅木材可 2:1 交易，其他资源仍按无港口 4:1 或其他港口规则交易。
玩家间贸易：无汇率限制，双方自由协商资源交换比例，可结合港口优势制定交易策略，获取额外收益。

# 拼接地图
一、海洋框架与地形板块拼接规则（基础公平）
海洋框架搭建：用 6 个海洋板块拼出正六边形框架，固定版图边界，确保所有地形板块有统一放置区域，无边界争议。
地形板块核心规则
数量固定：19 个板块（1 沙漠 + 4 种资源各 4-5 个，确保资源总量均衡）。
布局结构：中间 1 块，向外分三层（5→4→4→3→3），形成对称六角形，避免边缘与中心板块数量差异过大。
公平性约束：沙漠优先放中心（强盗初始位置固定，避免某区域长期被强盗封锁）；相同资源板块尽量分散，减少资源扎堆，保证玩家开局有多样选择。
随机化流程：所有地形板块洗匀后随机摆放，新手可先用官方推荐的均衡布局练手。
二、数字圆片（概率标记）拼接规则（概率公平）
数字圆片共 18 个（无 7），核心是避免高概率数字集中，平衡资源产出概率。
规则	内容	公平性目的
红数隔离	红色数字 6 和 8（最高概率，各 2 个）不能相邻，防止某区域频繁产资源	避免单一区域资源垄断，分散高收益点位
概率分散	5、9（次高概率，各 2 个）等数字均匀分布，同数字不集中	让所有玩家都有机会靠近高概率地形
随机放置	洗匀数字圆片后，随机放在非沙漠的地形板块上，不按固定顺序	消除人为选择带来的偏向性，确保概率随机分配
三、港口拼接规则（交易公平）
港口共 9 个（4 个 3:1 通用 + 5 个 2:1 特殊资源），规则如下：
位置固定：只能放在海洋板块与内陆地形板块相邻的边缘交点，不占用内陆资源板块位置。
随机分布：洗匀港口后与海洋板块交替摆放，围绕内陆地形板块形成一圈，确保每个方向都有港口，无区域交易优势失衡。
类型均衡：特殊资源港口每种资源各 1 个，通用港口均匀穿插，避免某类资源交易优势过度集中。

# 玩家回合
卡坦岛正式回合分生产阶段与行动阶段，核心可做掷骰产资源、交易、建造、打发展卡四类操作且没有次数和次序限制，流程与限制清晰，下面用大白话讲透并附速查：
一、回合核心流程（按顺序 + 可灵活调整点）
生产阶段（必做，除非先打骑士卡）
掷骰子：掷 1 次 2 颗骰子，总和对应地形数字产资源；定居点得 1 份，城市得 2 份。
处理 7 点：掷出 7 时，先让所有手牌超 7 张的玩家弃半（向下取偶），再移动强盗到任意非沙漠板块，封锁该板块资源，可偷 1 个相邻玩家 1 张资源卡。
可选前置：掷骰前可打 1 张非当回合买的发展卡（如骑士卡，移动强盗后再掷骰）CATAN。
行动阶段（全可选，顺序自由）
交易：与银行（无港口 4:1、有港口 3:1/2:1）或玩家（比例自由协商）交易资源，仅本回合玩家可发起 / 参与。
建造（含买发展卡）：按成本支付资源执行，无次数上限（只要资源够），规则如下：
| 建筑 / 卡牌 | 资源成本 | 核心规则 |
| ---- | ---- | ---- |
| 道路 | 1 木材 + 1 砖块 | 连自己道路 / 定居点，每边 1 条 |
| 定居点 | 1 木材 + 1 砖块 + 1 羊毛 + 1 粮食 | 空交点，距其他定居点≥1 个交点，连自己道路 |
| 城市 | 3 矿石 + 2 粮食 | 升级自身定居点，产量翻倍 |
| 发展卡 | 1 矿石 + 1 羊毛 + 1 粮食 | 抽 1 张（骑士 / 进度 / 胜利点），当回合不能用（胜利点除外）|
打发展卡：每回合限 1 张（非当回合买的），骑士卡可移动强盗偷资源，进度卡有资源 / 道路 / 垄断等效果，胜利点卡可攒着，决胜时可多打CATAN。
回合结束：检查胜利点数（通常 10 点），达标则立即获胜；否则骰子顺时针传递给下家CATAN。
二、关键限制与例外
发展卡：当回合购买的卡本回合不能用（胜利点卡可随时打以获胜），每回合仅能打 1 张非当回合买的卡CATAN。
建造距离：定居点必须与其他定居点间隔 1 个交点（相邻 3 个交点无建筑）。
道路连接：新道路必须连自己已有道路 / 定居点 / 城市。
骑士卡：打出后计入骑士数，凑 3 张可拿最大骑士奖（2 胜利点），可被超越。

# 强盗逻辑


# AI prompt记录
1，港口位置不应该占用内陆，并且一个港口对应两个可使用港口的位置（详见图片）
![alt text](image.png)
2，地图板块和上面的点数分别随机，一个随机不应该影响另一个
3，地图布置好了之后，再进入初始放置阶段


1, 沙漠只能有一个且必须在中间，其他板块要尽量平均分布
2，游戏日志可以隐藏


1，港口怎么不见了
2，地图板块的点数不见了，除了沙漠应该都有点数
3，地图板块和上面的点数分别随机，一个随机不应该影响另一个
4，地图布置好了之后，再进入初始放置阶段，初始放置阶段才能放置定居点和道路


1，港口不是随机分布，而是均匀分布在大陆边缘且不在内陆（详见图片）
2，无论怎么随机地图，沙漠必须在正中心

你还是没有正确设置港口位置

1，港口位置在大陆外侧，不在内侧，接入点必须临海
2，港口与港口之间的距离在2-3个边，并且均匀分布在大陆周围，港口位置固定，不是随机的

在海上均匀放置9个港口，港口之间距离在2-3个边，每个港口对应2个版图边缘的交点，该交点是定居点 / 城市的合法放置点。
港口类型分布：4 个 3:1 通用港口，5 个 2:1 特殊资源港口（木材、羊毛、砖块、矿石、粮食各 1 个）。
二、港口的类型与作用
港口的核心作用是降低与银行航海交易的资源消耗，仅当玩家在港口对应的交点建有定居点 / 城市时，才能享受该港口的交易优惠。
港口类型	数量	交易优惠	核心作用
3:1 通用港口	4	3 张同类型资源卡换 1 张任意资源卡	适配资源种类较多的开局，灵活补充稀缺资源，降低交易成本
2:1 特殊资源港口	5（每种资源 1 个）	2 张指定类型资源卡换 1 张任意资源卡	适合该资源产出稳定的玩家，大幅提升该资源的交易效率，快速补齐发展缺口
三、交易规则（含港口与无港口）
交易分玩家间贸易（国内贸易）和与银行贸易（航海贸易），仅当前回合玩家可发起或参与交易。
无港口时：航海贸易默认 4:1，即 4 张同类型资源卡换 1 张任意资源卡。
有港口时：仅触发对应港口的优惠汇率，不可叠加；例如在木材 2:1 港口建了定居点，仅木材可 2:1 交易，其他资源仍按无港口 4:1 或其他港口规则交易。


港口不应放置在大陆里面，你有两个港口放在里面了

1，地图板块和上面的点数分别随机，一个随机不应该影响另一个
2，回合内可以建设定居点、道路、城市
3，贸易和银行交易（4个任意资源换1个任意资源）以及和其他玩家交易，玩家交易的时候需要处于自己回合的玩家指定一个玩家，并且各自选择自己手里的资源进行交换
4，港口交易通过点击**自己占领的港口**图标进行交易